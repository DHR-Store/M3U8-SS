<!<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern M3U8 Player</title>
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <style>
        /* Basic styling for the page */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-color: #1a1a2e; /* Darker, modern background */
            display: flex;
            justify-content: center;
            /* Changed to column to stack header and player-container */
            flex-direction: column;
            align-items: center; /* Center horizontally */
            min-height: 100vh;
            color: #e0e0e0; /* Light text for dark background */
            /* Add padding-top to account for the fixed header */
            padding-top: 100px; /* Adjust based on your header's actual height + desired spacing */
            box-sizing: border-box; /* Include padding in element's total width and height */
        }

        /* Profile Header Styles */
        .profile-header {
            display: flex;
            align-items: center;
            justify-content: center; /* Center horizontally */
            padding: 20px;
            background-color: #1f1f3a; /* Darker background for the header */
            border-bottom: 1px solid #40407a;
            width: 100%; /* Take full width */
            box-sizing: border-box; /* Include padding in width */
            position: fixed; /* Fixed position at the top */
            top: 0;
            left: 0;
            z-index: 1000; /* Ensure it's above other content */
            height: 80px; /* Fixed height for the header */
        }

        .profile-picture {
            width: 60px; /* Size of the circle image */
            height: 60px;
            border-radius: 50%; /* Makes it a circle */
            object-fit: cover; /* Ensures the image covers the area without distortion */
            margin-right: 15px;
            border: 3px solid #6e8efb; /* Accent border */
            box-shadow: 0 0 10px rgba(110, 142, 251, 0.5); /* Subtle glow */
        }

        .profile-name {
            font-size: 24px;
            font-weight: bold;
            color: #e0e0e0; /* Light text color */
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5); /* Subtle text shadow */
        }

        .player-container {
            width: 90%;
            max-width: 900px; /* Slightly wider for a more immersive feel */
            background-color: #2c2c54; /* Darker container background */
            border-radius: 15px; /* More pronounced rounded corners */
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25); /* Softer, deeper shadow */
            overflow: hidden;
            border: 1px solid #40407a; /* Subtle border */
            display: flex; /* Use flexbox for layout */
            flex-direction: column; /* Stack elements vertically */
            margin-top: 20px; /* Add some space below the header padding */
            margin-bottom: 20px; /* Add some space at the bottom */
        }

        .input-container {
            padding: 25px;
            border-bottom: 1px solid #40407a; /* Border matching container */
            display: flex;
            gap: 15px; /* Increased gap */
            background-color: #1f1f3a; /* Slightly different shade for input area */
            flex-wrap: wrap; /* Allow wrapping on small screens */
        }

        .input-container input[type="text"] {
            flex-grow: 1;
            padding: 15px;
            border: 1px solid #40407a;
            border-radius: 8px;
            font-size: 16px;
            background-color: #2c2c54; /* Matching input field background */
            color: #e0e0e0; /* Light text in input */
            outline: none; /* Remove default outline */
            min-width: 200px; /* Ensure input is not too small */
        }

        .input-container input[type="text"]::placeholder {
            color: #8a8a9e; /* Softer placeholder color */
        }

        .input-container input[type="text"]:focus {
            border-color: #7a7ade; /* Highlight on focus */
            box-shadow: 0 0 8px rgba(122, 122, 222, 0.3); /* Glow effect on focus */
        }

        .input-container button {
            padding: 15px 25px;
            background: linear-gradient(135deg, #6e8efb, #a777e3); /* Modern gradient */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .input-container button:hover {
            transform: translateY(-2px); /* Subtle hover lift */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #5a78e4, #9060c9); /* Darker gradient on hover */
        }

        /* Video.js Customization */
        .video-wrapper {
            position: relative;
            height: 0;
            overflow: hidden;
            background-color: #000; /* Black background for the video area */
            padding-bottom: 56.25%; /* Default 16:9 aspect ratio, will be adjusted by JS */
        }

        #my-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* --- Modern & Attractive Video.js Skin Overrides --- */

        /* Overall Player Look */
        .video-js {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Consistent font */
            border-radius: 0 0 15px 15px; /* Match container bottom radius */
        }

        /* Big Play Button - Centered */
        .vjs-big-play-button {
            background-color: rgba(44, 44, 84, 0.7) !important; /* Darker, semi-transparent */
            border-color: rgba(122, 122, 222, 0.8) !important; /* Accent color border */
            border-radius: 50% !important; /* Circular button */
            width: 3em !important;
            height: 3em !important;
            line-height: 3em !important;
            font-size: 3em !important; /* Larger icon */
            transition: all 0.3s ease !important;
        }

        .vjs-big-play-button:hover {
            background-color: rgba(74, 74, 134, 0.9) !important;
            transform: scale(1.1);
        }

        .vjs-icon-play:before, .vjs-big-play-button .vjs-icon-placeholder:before {
            color: #e0e0e0 !important; /* Light icon color */
        }

        /* Control Bar */
        .video-js .vjs-control-bar {
            background-color: rgba(28, 28, 58, 0.85) !important; /* Dark, slightly transparent control bar */
            height: 4em !important; /* Taller control bar */
            padding: 0 15px !important;
            border-top: 1px solid #40407a;
        }

        /* Buttons in Control Bar */
        .video-js .vjs-control {
            color: #c0c0e0 !important; /* Lighter icon color for controls */
            width: 4em !important; /* Wider buttons */
            transition: color 0.3s ease;
        }

        .video-js .vjs-control:hover {
            color: #ffffff !important; /* White on hover */
        }

        /* Progress Bar / Seek Bar */
        .video-js .vjs-progress-control {
            height: 100%;
        }
        .video-js .vjs-progress-holder {
            height: 10px !important; /* Thicker progress bar */
            border-radius: 5px !important;
            background-color: rgba(64, 64, 122, 0.7) !important; /* Background of the bar */
            margin: auto 10px !important; /* Center vertically and add horizontal margin */
        }

        .video-js .vjs-play-progress,
        .video-js .vjs-load-progress {
            border-radius: 5px !important;
        }

        .video-js .vjs-play-progress {
            background: linear-gradient(135deg, #6e8efb, #a777e3) !important; /* Gradient for played progress */
        }
        .video-js .vjs-play-progress:before { /* Progress nub */
            color: #ffffff !important;
            font-size: 1.2em !important;
            top: -0.35em !important; /* Adjust position */
            background-color: #a777e3;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(167, 119, 227, 0.8);
        }

        .video-js .vjs-load-progress {
            background-color: rgba(122, 122, 222, 0.5) !important; /* Loaded part of the bar */
        }

        /* Volume Control */
        .video-js .vjs-volume-panel {
            width: 5em !important; /* Consistent width */
        }
        .video-js .vjs-volume-bar {
            background-color: rgba(64, 64, 122, 0.7) !important;
            height: 6px !important; /* Thinner volume bar */
            border-radius: 3px !important;
            margin-top: 1.7em !important; /* Adjust vertical alignment */
        }
        .video-js .vjs-volume-level {
            background: linear-gradient(to right, #6e8efb, #a777e3) !important;
            border-radius: 3px !important;
        }
        .video-js .vjs-volume-level:before { /* Volume nub */
            background-color: #a777e3;
            border-radius: 50%;
            box-shadow: 0 0 3px rgba(167, 119, 227, 0.8);
            width: 10px;
            height: 10px;
            top: -2px;
            left: -5px; /* Center the smaller nub */
        }

        /* Time Display */
        .video-js .vjs-time-control {
            font-size: 1em !important;
            line-height: 4em !important; /* Align with taller control bar */
            padding: 0 0.5em !important;
            color: #e0e0e0 !important;
        }

        /* Quality Selector (if using videojs-contrib-quality-levels or similar) */
        .vjs-menu-button-popup .vjs-menu .vjs-menu-item:hover {
            background-color: #40407a !important; /* Hover color for menu items */
            color: #ffffff !important;
        }
        .vjs-menu-button-popup .vjs-menu .vjs-selected {
            background-color: #5a78e4 !important; /* Selected item color */
            color: #ffffff !important;
        }

        /* Error Display */
        .vjs-error-display .vjs-modal-dialog-content {
            background-color: rgba(28, 28, 58, 0.9) !important;
            color: #ff6b6b !important; /* Error text color */
            border-radius: 8px;
            padding: 20px;
        }

        /* Poster Image */
        .vjs-poster {
            background-size: cover;
            background-position: center;
            border-radius: 0; /* Make sure poster doesn't interfere with player radius */
        }

        /* Channel List Styling */
        .channel-list-container {
            padding: 20px;
            background-color: #1f1f3a;
            border-top: 1px solid #40407a;
            max-height: 400px; /* Limit height for scrollability, increased for more channels */
            overflow-y: auto; /* Enable vertical scrolling */
        }

        .channel-list-container h3 {
            margin-top: 0;
            color: #a777e3;
            text-align: center;
            margin-bottom: 15px;
        }

        .channel-list-container input[type="search"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid #40407a;
            background-color: #2c2c54;
            color: #e0e0e0;
            font-size: 16px;
            outline: none;
        }

        .channel-list-container input[type="search"]::placeholder {
            color: #8a8a9e;
        }

        #channel-select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #40407a;
            background-color: #2c2c54;
            color: #e0e0e0;
            font-size: 16px;
            appearance: none; /* Remove default dropdown arrow */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20256%20256%22%3E%3Cpath%20fill%3D%22%23e0e0e0%22%20d%3D%22M128%2C192l-64-64h128z%22%2F%3E%3C%2Fsvg%3E'); /* Custom arrow */
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
            cursor: pointer;
        }

        #channel-select option {
            background-color: #2c2c54;
            color: #e0e0e0;
        }

        #channel-select optgroup {
            background-color: #3a3a6b; /* Darker background for optgroup labels */
            color: #a777e3; /* Accent color for optgroup labels */
            font-weight: bold;
            font-size: 1.1em;
            padding: 5px 0;
        }

        #channel-select option:hover {
            background-color: #40407a;
        }

        .share-container {
            padding: 20px;
            background-color: #1f1f3a;
            border-top: 1px solid #40407a;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .share-container label {
            font-size: 1.1em;
            color: #a777e3;
            text-align: center;
        }

        .share-container input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #40407a;
            border-radius: 8px;
            background-color: #2c2c54;
            color: #e0e0e0;
            font-size: 14px;
            outline: none;
            cursor: text;
        }

        .share-container button {
            padding: 10px 15px;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .share-container button:hover {
            transform: translateY(-1px);
            background: linear-gradient(135deg, #5a78e4, #9060c9);
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 600px) {
            .profile-header {
                height: 70px; /* Slightly smaller header on mobile */
                padding: 15px;
            }
            .profile-picture {
                width: 50px;
                height: 50px;
            }
            .profile-name {
                font-size: 20px;
            }
            body {
                padding-top: 90px; /* Adjust padding for smaller header */
            }
            .player-container {
                width: 98%;
                border-radius: 10px;
            }
            .input-container {
                flex-direction: column; /* Stack input and button */
                padding: 15px;
            }
            .input-container input[type="text"] {
                font-size: 14px;
            }
            .input-container button {
                font-size: 14px;
                padding: 12px;
            }
            .video-js .vjs-control-bar {
                height: 3.5em !important;
                padding: 0 10px !important;
            }
            .video-js .vjs-control {
                width: 3.5em !important;
            }
            .video-js .vjs-time-control {
                font-size: 0.9em !important;
                line-height: 3.5em !important;
            }
            .vjs-big-play-button {
                font-size: 2.5em !important;
            }
            .channel-list-container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>

    <div class="profile-header">
        <img src="images.jpeg" alt="Profile Picture" class="profile-picture"> <span class="profile-name">𝔊𝔬𝔧𝔬 𝔖𝔞𝔱𝔬𝔯𝔲</span>
    </div>

    <div class="player-container">
        <div class="input-container">
            <input type="text" id="m3u8-url" placeholder="Enter M3U8 URL (e.g., http://live.redtraffic.xyz/teen.m3u8)" value=https://aajtaklive-amd.akamaized.net/hls/live/2014416/aajtak/aajtaklive/live_404p/chunks.m3u8">
            <button id="load-m3u8">Load Stream</button>
        </div>

        <div class="channel-list-container">
            <h3>Load from Custom or Public IPTV List</h3>
            <input type="search" id="channel-search" placeholder="Search by channel name or country...">
            <select id="channel-select">
                <option value="">-- Select a Channel --</option>
            </select>
        </div>

        <div class="video-wrapper">
             <video
                id="my-video"
                class="video-js vjs-default-skin vjs-big-play-centered"
                controls
                preload="auto"
                width="100%"
                height="100%"
                data-setup='{}'>
                <p class="vjs-no-js">
                    To view this video please enable JavaScript, and consider upgrading to a
                    web browser that
                    <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
                </p>
            </video>
        </div>

        <div class="share-container">
            <label for="share-link">Share this stream:</label>
            <input type="text" id="share-link" readonly>
            <button id="copy-share-link">Copy Share Link</button>
        </div>
    </div>

    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const videoPlayer = videojs('my-video', {
                aspectRatio: '16:9',
                fluid: true,
                autoplay: false,
                controls: true,
                playbackRates: [0.5, 1, 1.5, 2],
                controlBar: {
                    children: [
                        'playToggle',
                        'volumePanel',
                        'currentTimeDisplay',
                        'timeDivider',
                        'durationDisplay',
                        'progressControl',
                        'liveDisplay',
                        'seekToLive',
                        'remainingTimeDisplay',
                        'playbackRateMenuButton',
                        'descriptionsButton',
                        'subtitlesButton',
                        'captionsButton',
                        'audioTrackButton',
                        'fullscreenToggle'
                    ]
                },
                html5: {
                    hls: {
                        overrideNative: true,
                    }
                },
                userActions: {
                    doubleClick: true
                },
            });

            const m3u8UrlInput = document.getElementById('m3u8-url');
            const loadM3u8Button = document.getElementById('load-m3u8');
            const videoWrapper = document.querySelector('.video-wrapper');
            const channelSelect = document.getElementById('channel-select');
            const channelSearchInput = document.getElementById('channel-search'); // New search input
            const shareLinkInput = document.getElementById('share-link');
            const copyShareLinkButton = document.getElementById('copy-share-link');

    // --- Custom M3U8 Links (Add your own here!) ---
            const customChannels = [
               { name: " (Big Buck Bunny)", url: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8", category: "Samples" },
  { name: "(Sintel Trailer)", url: "https://bitmovin-a.akamaihd.net/content/sintel/hls/playlist.m3u8", category: "Samples" },
  { name: "mycam tv", url: "http://live.redtraffic.xyz/teen.m3u8", category: "Tests" },
  { name: "STAR PLUS HD", url: "http://51.15.8.16:8081/ind1live/starplususa/playlist.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "ZEE TV", url: "https://itpolly.iptv.digijadoo.net/live/zee_tv/chunks.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "STAR BHARAT", url: "https://itpolly.iptv.digijadoo.net/live/star_bharat/chunks.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "STAR PLUS", url: "https://itpolly.iptv.digijadoo.net/live/star_plus/chunks.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "STAR WORLD", url: "https://itpolly.iptv.digijadoo.net/live/star_world/chunks.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "STAR WORLD HD", url: "http://51.15.8.16:8081/ind1live/starworld/playlist.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "ZEETV HD", url: "http://51.15.8.16:8081/ind1live/zeetvme/playlist.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "SONY TV", url: "http://51.15.8.16:8081/ind1live/sonytv/playlist.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "STAR PLUS HD", url: "http://51.15.8.16:8081/ind1live/starplusuk/playlist.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "ZEETV", url: "http://51.15.8.16:8081/ind1live/zeetv/playlist.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "ZEETV", url: "http://51.15.8.16:8081/ind1live/zeetvuk/playlist.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "STAR BHARAT HD", url: "http://51.15.8.16:8081/ind1live/starbharat/playlist.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "STAR PLUS", url: "http://51.15.8.16:8081/ind1live/starplus/playlist.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "KAPTIAL TV", url: "http://163.172.172.80:8080/hls/livestream.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "AXN", url: "http://av.xemtivinet.net:8080/hls/axn/index.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "ID", url: "http://84.22.33.254/unicast.id/index.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "COLORS TV", url: "http://51.15.8.16:8081/lolind2/colorstvuk/playlist.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "SONY TV", url: "http://51.15.8.16:8081/lolind2/sonytvuk/playlist.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "AXN HD", url: "http://51.15.8.16:8081/lolind2/sonytvhd/playlist.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "SONY SAB HD", url: "http://51.15.8.16:8081/lolind2/sonysabhd/playlist.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "SONY PAL", url: "http://51.15.8.16:8081/lolind2/sonypal/playlist.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "COLORS HD", url: "https://triangle.iptv.digijadoo.net/live/colors_hd/chunks.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "&TV HD", url: "http://45.120.188.76:8080/0.ts", category: "ENTERTAINMENT CHANNELS" },
  { name: "&TV HD", url: "http://173.212.237.70/zee5.php?url=http://z5ams.akamaized.net/andtvhdusa/index.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "COLORS TV", url: "http://103.111.120.46/hls/Colors.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "AXN", url: "http://210.210.155.66/h/h141/01.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "COLORS TV", url: "https://1784075063.rsc.cdn77.org/1784075063/tracks-v1a1/mono.m3u8", category: "ENTERTAINMENT CHANNELS" },
  { name: "ZING", url: "https://itpolly.iptv.digijadoo.net/live/zing/chunks.m3u8", category: "MUSIC & CHANNELS" },
  { name: "SONY MIX", url: "http://51.15.8.16:8081/lolind2/sonymix/playlist.m3u8", category: "MUSIC & CHANNELS" },
  { name: "ZOOM", url: "http://livecdnh1.tvanywhere.ae/hls/zoom/04.m3u8", category: "MUSIC & CHANNELS" },
  { name: "VH1", url: "http://185.59.223.82:8080/vh1/mpegts", category: "MUSIC & CHANNELS" },
  { name: "MTV", url: "http://unilivemtveu-lh.akamaihd.net/i/mtvno_1@346424/master.m3u8", category: "MUSIC & CHANNELS" },
  { name: "MASTI", url: "http://103.68.116.50/live/feed1014/index.m3u8", category: "MUSIC & CHANNELS" },
  { name: "9XO", url: "http://d2q8p4pe5spbak.cloudfront.net/bpk-tv/9XO/9XO.isml/index.m3u8", category: "MUSIC & CHANNELS" },
  { name: "CARTOON NETWORK", url: "http://av.xemtivinet.net:8080/hls/cartoon/index.m3u8", category: "KIDS CHANNELS" },
  { name: "BABY FIRSTS", url: "http://ms003.happytv.com.tw/live/F9YMztT5DcwWEr1f/index.m3u8", category: "KIDS CHANNELS" },
  { name: "BOOMERANG", url: "http://livecdnh3.tvanywhere.ae/hls/boomerang/index.m3u8", category: "KIDS CHANNELS" },
  { name: "BOOMERANG", url: "https://delivery.macan.live/stream/boomerang/index.m3u8?token=BnCg4oKx&v=20200202", category: "KIDS CHANNELS" },
  { name: "CARTOON NETWORK HD", url: "https://tv4.chang55.com/live2/tv4ch20.stream/chunks.m3u8", category: "KIDS CHANNELS" },
  { name: "DISNEY CHANNEL", url: "http://ott.artmott.com/DisneyChannel/tracks-v1a1/mono.m3u8", category: "KIDS CHANNELS" },
  { name: "CNN", url: "https://tv4.chang55.com/live2/tv4ch27.stream/chunks.m3u8", category: "NEWS CHANNELS" },
  { name: "CBS NEWS", url: "https://cbsnewshd-lh.akamaihd.net/i/CBSNHD_7@199302/master.m3u8", category: "NEWS CHANNELS" },
  { name: "BBC NEWS", url: "https://edge-1192-ch-gv.filmon.com/live/27.low.stream/playlist.m3u8", category: "NEWS CHANNELS" },
  { name: "NDTV24X7", url: "https://ndtv24x7elemarchana.akamaized.net/hls/live/2003678/ndtv24x7/ndtv24x7master.m3u8", category: "NEWS CHANNELS" },
  { name: "ZEE NEWS", url: "http://51.15.8.16:8081/ind1live/zeenews/playlist.m3u8", category: "NEWS CHANNELS" },
  { name: "ZEE BUSINESS", url: "http://samrapro.com:7766/live/ramis/123456/82714.m3u8", category: "NEWS CHANNELS" },
  { name: "APB NEWS HD", url: "https://abp-i.akamaihd.net/hls/live/765529/abphindi/masterhls_1564.m3u8", category: "NEWS CHANNELS" },
  { name: "NORTH EAST LIVE", url: "https://cdn.pride-east.in/smartstream-us/mbrstreammbr/mbrstreammbr.smil/chunks.m3u8", category: "NEWS CHANNELS" },
  { name: "CNA", url: "https://d2e1asnsl7br7b.cloudfront.net/7782e205e72f43aeb4a48ec97f66ebbe/index_5.m3u8", category: "NEWS CHANNELS" },
  { name: "CGTN", url: "https://news.cgtn.com/resource/live/english/cgtn-news.m3u8", category: "NEWS CHANNELS" },
  { name: "NEWS 18 ASSAM", url: "https://news18assam-lh.akamaihd.net/i/n18assamne_1@526575/index_5_av-p.m3u8", category: "NEWS CHANNELS" },
  { name: "NDTV INDIA", url: "https://d3t34m8y8rh0vb.cloudfront.net/preview/ndtvhindi/350.m3u8", category: "NEWS CHANNELS" },
  { name: "NHK WORLD", url: "https://nhkworld.webcdn.stream.ne.jp/www11/nhkworld-tv/global/2003458/live.m3u8", category: "NEWS CHANNELS" },
  { name: "FOX SPORTS NEWS", url: "https://austchannel-live.akamaized.net/hls/live/2002736/austchannel-sport/master.m3u8", category: "NEWS CHANNELS" },
  { name: "DD NEWS", url: "http://nicls1-lh.akamaihd.net/i/ddnews_1@409133/master.m3u8", category: "NEWS CHANNELS" },
  { name: "NHK WORLD", url: "http://210.210.155.66/h/h23/01.m3u8", category: "NEWS CHANNELS" },
  { name: "CNA", url: "http://210.210.155.66/h/h29/02.m3u8", category: "NEWS CHANNELS" },
  { name: "FOX SPORTS", url: "https://tv4.chang55.com/live2/tv4ch09.stream/chunks.m3u8", category: "SPORTS CHANNELS" },
  { name: "TURE SPORTS", url: "https://tv4.chang55.com/live2/tv4ch18.stream/chunks.m3u8", category: "SPORTS CHANNELS" },
  { name: "SONY TEN 2 HD", url: "http://51.15.8.16:8081/lolind2/sonyten2hd/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9Mi8zLzIwMjAgMTE6MjM6MzcgQU0maGFzaF92YWx1ZT1vM1NPQzhMZFhtUHo0UUZ1Y1lWRWNRPT0mdmFsaWRtaW51dGVzPTI=", category: "SPORTS CHANNELS" },
  { name: "STAR SPORTS 1 HINDI", url: "http://51.15.8.16:8081/ind1live/starsports1hindi/playlist.m3u8", category: "SPORTS CHANNELS" },
  { name: "STAR SPORTS SELECT1", url: "http://51.15.8.16:8081/ind1live/starsportsselect1/playlist.m3u8", category: "SPORTS CHANNELS" },
  { name: "STAR SPORTS SELECT2 HD", url: "http://51.15.8.16:8081/ind1live/starsportsselect2/playlist.m3u8", category: "SPORTS CHANNELS" },
  { name: "ONE GOLF", url: "http://162.250.201.58:6211/pk/ONEGOLF/tracks-v1a1/mono.m3u8", category: "SPORTS CHANNELS" },
  { name: "STAR SPORTS 2", url: "http://51.15.8.16:8081/ind1live/starsports2/playlist.m3u8", category: "SPORTS CHANNELS" },
  { name: "CCA", url: "https://snagfilms-lh.akamaihd.net/i/Laxsportsnetwork_1@322790/index_2800_av-p.m3u8?sd=10&rebase=on", category: "SPORTS CHANNELS" },
  { name: "SONY TEN 1 HD", url: "http://51.15.8.16:8081/lolind2/sonyten1hd/playlist.m3u8", category: "SPORTS CHANNELS" },
  { name: "SONY TEN 2 HD", url: "http://51.15.8.16:8081/lolind2/sonyten2hd/playlist.m3u8", category: "SPORTS CHANNELS" },
  { name: "SONY TEN 3", url: "http://51.15.8.16:8081/lolind2/sonyten3/playlist.m3u8", category: "SPORTS CHANNELS" },
  { name: "D SPORTS", url: "http://jiocgehub.jio.ril.com/Dsports_HD/Dsports_HD_800.m3u8", category: "SPORTS CHANNELS" },
  { name: "SPORT MAX", url: "https://ch.iptvmate.net/d632f569730eaeaee6f99d050e1fb9e0.m3u8", category: "SPORTS CHANNELS" },
  { name: "STAR SPORTS 2", url: "http://103.68.116.50/live/feed1006/index.m3u8", category: "SPORTS CHANNELS" },
  { name: "SONY SIX", url: "http://103.68.116.50/live/feed1004/index.m3u8", category: "SPORTS CHANNELS" },
  { name: "PLAY BOY TV", url: "http://62.203.143.51:9981/play/PlayyTV", category: "ADULT CHANNELS" },
  { name: "XXXTV", url: "http://publish.thewebstream.co:1935/ppv/definst/rampanttv_passionxxx/playlist.m3u8", category: "ADULT CHANNELS" },
  { name: "CHANNEL X", url: "http://bmiptv.live:5858/live/free/free/6977.m3u8", category: "ADULT CHANNELS" },
  { name: "MOMS EACH SEX TV", url: "http://bmiptv.live:5858/live/free/free/6979.m3u8", category: "ADULT CHANNELS" },
  { name: "CZECH COUPLES TV", url: "http://bmiptv.live:5858/live/free/free/6978.m3u8", category: "ADULT CHANNELS" },
  { name: "BRAZZERS TV", url: "http://bmiptv.live:5858/live/free/free/6976.m3u8", category: "ADULT CHANNELS" },
  { name: "VUNES", url: "http://209.126.102.141/FQVbwkwBzMaUy9v3/lamvtv/get.php?get=live&url=aHR0cDovLzIzLjIzNy4zNi45ODoyNTQ2MS9saXZlL0FEVUxUT1MtTEFNVFYvbG5tTXd4akJ2cy8xODUubTN1OA==&type=playlist.m3u8", category: "ADULT CHANNELS" },
  { name: "HUSTLER HD", url: "http://x-bosna.no-ip.biz:80/live.ts?channelId=148&deviceUser=MamaTata&devicePass=hwVv4Mb5yarbaGHAIfET&uid=491", category: "ADULT CHANNELS" },
  { name: "BIG DICK", url: "http://live.redtraffic.xyz/bigdick.m3u8?streamType=live", category: "ADULT CHANNELS" },
  { name: "BRUNETTE", url: "http://cdn.adultiptv.net/brunette.m3u8", category: "ADULT CHANNELS" },
  { name: "BOZZTV1", url: "https://usb.bozztv.com/ssh101/TBB2/TBB2/index.m3u8", category: "ADULT CHANNELS" },
  { name: "VUNES", url: "http://62.203.143.51:9981/play/Venus", category: "ADULT CHANNELS" },
  { name: "BOZZTV2", url: "https://usb.bozztv.com/ssh101/TBB4/TBB4/index.m3u8", category: "ADULT CHANNELS" },
  { name: "BOZZTV3", url: "https://usb.bozztv.com/ssh101/TBB5/TBB5/index.m3u8", category: "ADULT CHANNELS" },
  { name: "GAY", url: "http://cdn.adultiptv.net/gay.m3u8", category: "ADULT CHANNELS" },
  { name: "PORNSTAR", url: "http://live.redtraffic.xyz/pornstar.m3u8", category: "ADULT CHANNELS" },
  { name: "TEEN", url: "http://live.redtraffic.xyz/teen.m3u8", category: "ADULT CHANNELS" },
  { name: "HUSTLER HD", url: "http://bit.ly/37nMwWw", category: "ADULT CHANNELS" },
  { name: "BSX24", url: "http://publish.firestormmedia.tv:1935/bsx24/livestream/playlist.m3u8", category: "ADULT CHANNELS" },
  { name: "BRAZZERS", url: "http://185.180.12.90:8080/BRAZZERS/index.m3u8?token=test", category: "ADULT CHANNELS" },
  { name: "HUSTLER HD", url: "http://185.180.12.90:8080/HUSTLER/index.m3u8?token=test", category: "ADULT CHANNELS" },
  { name: "DORCEL TV", url: "http://185.180.12.90:8080/DORCEL/index.m3u8?token=test", category: "ADULT CHANNELS" },
  { name: "FOX LIFE", url: "https://itpolly.iptv.digijadoo.net/live/fox_life/chunks.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "INSIGHT", url: "http://jiocgehub.jio.ril.com/Insight/Insight_800.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "DISCOVERY SCIENCE", url: "http://185.180.12.90:8080/DISCOVERYSCIENCE/index.m3u8?token=test", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "HISTORY 2", url: "https://tv4.chang55.com/live2/tv4ch19.stream/chunks.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "DISCOVERY ASIA", url: "https://tv4.chang55.com/live2/tv4ch16.stream/chunks.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "HISTORY", url: "http://193.169.124.19:8000/play/a00c/index.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "NAT GEO PEOPLE", url: "https://itpolly.iptv.digijadoo.net/live/nat_geo_people/chunks.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "DISCOVERY CHANNEL", url: "https://live-orig-oiplay.online.go.oi.com.br/live-cdn/discoverychannel.smil/chunklist_b1431167_sleng.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "BETTER HEALTH TV", url: "http://uni5rtmp.tulix.tv:1935/betterhealth/betterhealth/playlist.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "DISCOVERY TURBO", url: "http://streamidvo.multitvsolution.in/live/TurboEng-a/p4.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "HISTORY 2", url: "http://livecdnh1.tvanywhere.ae/hls/h2/05.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "HISTORY", url: "http://185.180.12.90:8080/HISTORY/index.m3u8?token=test", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "FOOD FOOD", url: "https://sonyent.pc.cdn.bitgravity.com/sonyent/live/food_food.smil/chunklist_b1300000.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "FASHION TV", url: "http://fash1043.cloudycdn.services/slive/definst/ftv_paris_adaptive.smil/chunklist.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "NAT GEO", url: "https://cdn.jp.jpnettv.live/jptv/National_geographic/chunklist_w1310243407.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "DISCOVERY CHANNEL", url: "https://ch.iptvmate.net/f9f3b577fb5c147da4a0c03ce1c9e535.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "HISTORY", url: "https://tv4.chang55.com/live2/tv4ch21.stream/chunks.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "DISCOVERY CHANNEL", url: "http://streamidvo.multitvsolution.in/DiscoveryEng-a/playlist.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "CGTN DOCUMENTARY", url: "https://livedoc.cgtn.com/1000d/prog_index.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "DISCOVERY SCIENCE", url: "http://185.180.12.90:8080/DISCOVERYSCIENCE/index.m3u8?token=test", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "DISCOVERY CHANNEL", url: "http://83.167.253.110:5000/live/discovery/playlist.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "DISCOVERY SCIENCE", url: "http://streamidvo.multitvsolution.in/DiscoverScienceEng-a/playlist.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "ID", url: "http://ott.artmott.com/ID/tracks-v1a1/mono.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "DISCOVERY ASIA", url: "https://tv4.chang55.com/live2/tv4ch80.stream/chunks.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "DISCOVERY", url: "http://193.169.124.19:8000/play/a005/index.m3u8", category: "INFOTAINMENT & LIFESTYLE CHANNELS" },
  { name: "NAT GEO WILD", url: "https://itpolly.iptv.digijadoo.net/live/nat_geo_wild/chunks.m3u8", category: "WILDLIFE CHANNELS" },
  { name: "NAT GEO WILD", url: "http://51.15.8.16:8081/lolind2/pogo/playlist.m3u8", category: "WILDLIFE CHANNELS" },
  { name: "NAT GEO WILD", url: "http://178.124.183.13/hls/ESCMSBZJ8X/bw1200000/playlist.m3u8", category: "WILDLIFE CHANNELS" },
  { name: "NAT GEO WILD", url: "http://193.169.124.19:8000/play/a00a/index.m3u8", category: "WILDLIFE CHANNELS" },
  { name: "NAT GEO WILD", url: "http://itvago.com/NatGeoWildHD/video.m3u8?token=korolencoanatolkorolenco85", category: "WILDLIFE CHANNELS" },
  { name: "ANIMAL PLANET", url: "http://84.22.33.254/unicast.animalplanet/index.m3u8", category: "WILDLIFE CHANNELS" },
  { name: "FOX PREMIUM", url: "http://160.119.77.50/iptv/hd-foxpremium.stream/playlist.m3u8", category: "MOVIES CHANNELS" },
  { name: "HBO", url: "https://tv4.chang55.com/live2/tv4ch25.stream/chunks.m3u8", category: "MOVIES CHANNELS" },
  { name: "ZEE CLASSIC", url: "http://51.15.8.16:8081/ind1live/zeeclassic/playlist.m3u8", category: "MOVIES CHANNELS" },
  { name: "STAR GOLD", url: "http://51.15.8.16:8081/ind1live/stargolduk/playlist.m3u8", category: "MOVIES CHANNELS" },
  { name: "STAR GOLD", url: "http://51.15.8.16:8081/ind1live/stargold/playlist.m3u8", category: "MOVIES CHANNELS" },
  { name: "STAR MOVIES", url: "http://51.15.8.16:8081/ind1live/starmovies/playlist.m3u8", category: "MOVIES CHANNELS" },
  { name: "ZEE CINEMA", url: "http://51.15.8.16:8081/ind1live/zeecinema/playlist.m3u8", category: "MOVIES CHANNELS" },
  { name: "ZEE CINEMA", url: "http://51.15.8.16:8081/ind1live/zeecinemauk/playlist.m3u8", category: "MOVIES CHANNELS" },
  { name: "HBO", url: "http://av.xemtivinet.net:8080/hls/hbo/index.m3u8", category: "MOVIES CHANNELS" },
  { name: "MGM", url: "https://mgm-ssai.akamaized.net/amagi_hls_data_mgmAAAAAA-theworks/CDN/720x404_1425600/index.m3u8", category: "MOVIES CHANNELS" },
  { name: "ZEE CINEMA", url: "https://itpolly.iptv.digijadoo.net/live/zee_cinema/chunks.m3u8", category: "MOVIES CHANNELS" },
  { name: "STAR GOLD HD", url: "https://itpolly.iptv.digijadoo.net/live/star_gold/chunks.m3u8", category: "MOVIES CHANNELS" },
  { name: "B4U AFLAM", url: "http://samrapro.com:7766/live/ramis/123456/3126.m3u8", category: "MOVIES CHANNELS" },
  { name: "MBC BOLLYWOOD", url: "http://samrapro.com:7766/live/ramis/123456/1075.m3u8", category: "MOVIES CHANNELS" },
  { name: "BOLLYWOOD TV", url: "http://a.jsrdn.com/broadcast/d5b45/+0000/high/c.m3u8", category: "MOVIES CHANNELS" },
  { name: "COLORS CINEPLEX", url: "http://51.15.8.16:8081/lolind2/rishteycineplexuk/chunks.m3u8", category: "MOVIES CHANNELS" },
  { name: "MBC BOLLYWOOD", url: "http://63.237.48.3/ios/MBC_BOLLYWOOD/MBC_BOLLYWOOD.m3u8", category: "MOVIES CHANNELS" },
  { name: "HBO", url: "https://delivery.macan.live/stream/hbo/index.m3u8?token=gratisan", category: "MOVIES CHANNELS" },
  { name: "MOVIES NOW", url: "https://timesnow.airtel.tv/live/MN_pull/master.m3u8", category: "MOVIES CHANNELS" },
  { name: "B4U KARAK", url: "http://103.68.116.50/live/feed1013/index.m3u8", category: "MOVIES CHANNELS" },
  { name: "GEM BOLLYWOOD", url: "http://d2e40kvaojifd6.cloudfront.net/stream/gem_bollywood/playlist.m3u8", category: "MOVIES CHANNELS" },
  { name: "SONY MAX 2", url: "http://51.15.8.16:8081/lolind2/sonymax2/playlist.m3u8", category: "MOVIES CHANNELS" },
  { name: "HITS", url: "http://210.210.155.66/h/h37/index.m3u8", category: "MOVIES CHANNELS" }
];


            // Public IPTV GitHub source for M3U8 list (More comprehensive list)
            const IPTV_GITHUB_SOURCE = 'https://iptv-org.github.io/iptv/index.m3u';
            let allPublicChannels = []; // Store all fetched public channels

            let currentStreamUrl = '';

            function loadStream(url, preventAutoplay = false) {
                if (!url) {
                    alert('Please enter an M3U8 URL or select a channel.');
                    return;
                }

                currentStreamUrl = url;
                m3u8UrlInput.value = url; // Update the input field with the loaded URL
                updateShareLink(url); // Update the share link whenever a new stream is loaded

                if (!url.toLowerCase().endsWith('.m3u8') && !url.toLowerCase().includes('.ts')) {
                    console.warn("The URL doesn't end with .m3u8 or .ts. Attempting to load anyway.");
                }

                console.log('Loading stream:', url);
                videoPlayer.src({
                    src: url,
                    type: 'application/x-mpegURL'
                });

                if (!preventAutoplay) {
                    setTimeout(() => {
                        videoPlayer.play().catch(error => {
                            console.error("Error attempting to play video:", error);
                            if (error.name === 'NotAllowedError') {
                                console.warn("Autoplay was prevented. User interaction might be required.");
                            }
                        });
                    }, 100);
                }

                videoPlayer.on('loadedmetadata', function() {
                    const video = document.getElementById('my-video_html5_api');
                    if (video && video.videoHeight > 0 && video.videoWidth > 0) {
                        const aspectRatio = video.videoWidth / video.videoHeight;
                        videoWrapper.style.paddingBottom = (1 / aspectRatio) * 100 + '%';
                    } else {
                        videoWrapper.style.paddingBottom = '56.25%'; // Default 16:9 if metadata not available
                    }
                });
            }

            // Function to update the share link
            function updateShareLink(url) {
                const currentOrigin = window.location.origin;
                const currentPagePath = window.location.pathname.split('/').pop(); // Gets 'index.html' or similar
                const shareableUrl = `${currentOrigin}/${currentPagePath}?url=${encodeURIComponent(url)}`;
                shareLinkInput.value = shareableUrl;
            }

            loadM3u8Button.addEventListener('click', () => {
                loadStream(m3u8UrlInput.value.trim());
            });

            channelSelect.addEventListener('change', (event) => {
                const selectedUrl = event.target.value;
                if (selectedUrl) {
                    loadStream(selectedUrl);
                }
            });

            copyShareLinkButton.addEventListener('click', () => {
                shareLinkInput.select();
                shareLinkInput.setSelectionRange(0, 99999); // For mobile devices
                document.execCommand('copy');
                alert('Share link copied to clipboard!');
            });

            // Function to fetch and parse the comprehensive IPTV list
            async function fetchAndParseIptvList() {
                try {
                    const response = await fetch(IPTV_GITHUB_SOURCE);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const text = await response.text();
                    const lines = text.split('\n');
                    const channelsByCategory = {};

                    let currentCategory = 'Unknown';
                    let currentChannelName = '';
                    let currentChannelUrl = '';

                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (line.startsWith('#EXTINF:')) {
                            const tvgNameMatch = /tvg-name="([^"]*)"/.exec(line);
                            const groupTitleMatch = /group-title="([^"]*)"/.exec(line);
                            const nameMatch = /,(.*)/.exec(line);

                            currentChannelName = (tvgNameMatch && tvgNameMatch[1]) ? tvgNameMatch[1].trim() : (nameMatch && nameMatch[1] ? nameMatch[1].trim() : 'Unknown Channel');
                            currentCategory = (groupTitleMatch && groupTitleMatch[1]) ? groupTitleMatch[1].trim() : 'Other Channels';

                        } else if (line.startsWith('http') && (line.includes('.m3u8') || line.includes('.ts'))) {
                            currentChannelUrl = line.trim();
                            if (currentChannelName && currentChannelUrl) {
                                if (!channelsByCategory[currentCategory]) {
                                    channelsByCategory[currentCategory] = [];
                                }
                                channelsByCategory[currentCategory].push({
                                    name: currentChannelName,
                                    url: currentChannelUrl,
                                    category: currentCategory
                                });
                            }
                            // Reset for next channel
                            currentChannelName = '';
                            currentChannelUrl = '';
                        }
                    }

                    // Convert the object back to a flat array, preserving category for filtering
                    const flatChannels = [];
                    for (const category in channelsByCategory) {
                        flatChannels.push(...channelsByCategory[category]);
                    }
                    return { categorized: channelsByCategory, flat: flatChannels };

                } catch (error) {
                    console.error('Failed to fetch or parse public IPTV list:', error);
                    return { categorized: {}, flat: [] }; // Return empty objects on error
                }
            }

            function populateChannelSelect(categorizedChannels) {
                // Clear existing options, but keep the default "Select a Channel"
                channelSelect.innerHTML = '<option value="">-- Select a Channel --</option>';

                // Add Custom Channels first
                const customOptGroup = document.createElement('optgroup');
                customOptGroup.label = "My Custom Channels";
                customChannels.forEach(channel => {
                    const option = document.createElement('option');
                    option.value = channel.url;
                    option.textContent = channel.name;
                    customOptGroup.appendChild(option);
                });
                channelSelect.appendChild(customOptGroup);

                // Add Public IPTV Channels by category
                const sortedCategories = Object.keys(categorizedChannels).sort();
                sortedCategories.forEach(category => {
                    const optGroup = document.createElement('optgroup');
                    optGroup.label = category;
                    categorizedChannels[category].sort((a, b) => a.name.localeCompare(b.name)).forEach(channel => {
                        const option = document.createElement('option');
                        option.value = channel.url;
                        option.textContent = channel.name;
                        optGroup.appendChild(option);
                    });
                    channelSelect.appendChild(optGroup);
                });
            }

            // Function to filter channels based on search input
            function filterChannels() {
                const searchTerm = channelSearchInput.value.toLowerCase();
                // Clear the current dropdown but keep the initial option
                channelSelect.innerHTML = '<option value="">-- Select a Channel --</option>';

                // Add Custom Channels (always visible)
                const customOptGroup = document.createElement('optgroup');
                customOptGroup.label = "My Custom Channels";
                customChannels.forEach(channel => {
                    const option = document.createElement('option');
                    option.value = channel.url;
                    option.textContent = channel.name;
                    customOptGroup.appendChild(option);
                });
                channelSelect.appendChild(customOptGroup);

                const filteredPublicChannels = allPublicChannels.filter(channel =>
                    channel.name.toLowerCase().includes(searchTerm) ||
                    channel.category.toLowerCase().includes(searchTerm)
                );

                const filteredCategorized = {};
                filteredPublicChannels.forEach(channel => {
                    if (!filteredCategorized[channel.category]) {
                        filteredCategorized[channel.category] = [];
                    }
                    filteredCategorized[channel.category].push(channel);
                });

                populateChannelSelect(filteredCategorized);

                // If a stream is already loaded from a parameter and it's in the filtered list, keep it selected.
                // This might be tricky with dynamic filtering, usually, you'd only set the input value.
                // For simplicity, we won't re-select if filtered, just ensure the input URL remains.
            }

            // Add event listener for search input
            channelSearchInput.addEventListener('input', filterChannels);

            // --- Initial Load Logic ---
            async function initializePlayer() {
                const urlParams = new URLSearchParams(window.location.search);
                const streamUrlFromParam = urlParams.get('url');

                const { categorized, flat } = await fetchAndParseIptvList();
                allPublicChannels = flat; // Store the flat list for searching
                populateChannelSelect(categorized); // Populate initially with all channels

                if (streamUrlFromParam) {
                    // Load stream from URL parameter
                    const decodedUrl = decodeURIComponent(streamUrlFromParam);
                    m3u8UrlInput.value = decodedUrl;
                    loadStream(decodedUrl);

                    // Try to pre-select the channel in the dropdown if it exists
                    const foundChannel = allPublicChannels.find(ch => ch.url === decodedUrl) ||
                                         customChannels.find(ch => ch.url === decodedUrl);
                    if (foundChannel) {
                        channelSelect.value = decodedUrl;
                    }

                } else if (m3u8UrlInput.value.trim()) {
                    // Load default stream from input field
                    loadStream(m3u8UrlInput.value.trim());
                } else if (customChannels.length > 0) {
                    // Load the first custom channel if no URL parameter or default input
                    m3u8UrlInput.value = customChannels[0].url;
                    loadStream(customChannels[0].url);
                    channelSelect.value = customChannels[0].url; // Select it in the dropdown
                }
            }

            initializePlayer();


            videoPlayer.on('error', function() {
                const error = videoPlayer.error();
                console.error('Video.js Error:', error);
                alert(`Video Playback Error: ${error ? error.message : 'Unknown error'}. Please try a different URL.`);
            });

            videoPlayer.on('waiting', function() {
                console.log('Player is waiting for data (buffering)...');
            });

            videoPlayer.on('playing', function() {
                console.log('Player has started playing or resumed.');
            });

            videoPlayer.on('ended', function() {
                console.log('Video has ended.');
            });

            videoPlayer.on('fullscreenchange', function() {
                console.log('Fullscreen mode changed. Is fullscreen:', videoPlayer.isFullscreen());
            });

            videoPlayer.on('keydown', function(event) {
                if (event.key === 'm' || event.key === 'M') {
                    videoPlayer.muted(!videoPlayer.muted());
                }
                if (event.key === 'f' || event.key === 'F') {
                    if (videoPlayer.isFullscreen()) {
                        videoPlayer.exitFullscreen();
                    } else {
                        videoPlayer.requestFullscreen();
                    }
                }
                if (event.key === 'ArrowLeft') {
                    videoPlayer.currentTime(Math.max(0, videoPlayer.currentTime() - 10));
                }
                if (event.key === 'ArrowRight') {
                    videoPlayer.currentTime(Math.min(videoPlayer.duration(), videoPlayer.currentTime() + 10));
                }
            });

            if (Hls.isSupported()) {
                // Video.js uses Hls.js automatically when 'overrideNative: true' is set in html5 options
                // No direct HLS.js instance manipulation is typically needed here.
            } else if (videoPlayer.tech({ IWillNotUseThisInPlugins: true }).options_ &&
                       !videoPlayer.tech({ IWillNotUseThisInPlugins: true }).options_.nativeHls) {
                console.warn("HLS.js is not supported in this browser, and native HLS might not be either. Playback may fail for M3U8 streams.");
            }
        });
    </script>
</body>
</html>
